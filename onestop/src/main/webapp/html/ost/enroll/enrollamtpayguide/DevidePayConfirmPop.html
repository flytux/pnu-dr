<div id="popups">
	<section class="sec-1">
		<div class="sec-body">
			<input type="hidden" id="SYEAR">
			<input type="hidden" id="TERM_GCD">
			<input type="hidden" id="STDT_NO">
			<input type="hidden" id="rowStatus">
			<div class="b-table-box flex-col-3" id="stdtTable" role="table" aria-label="학적정보 테이블">
				<div class="b-row-box" role="row">
					<div class="b-row-item">
						<div class="b-title-box" role="rowheader">
							<label data-lang>대학(원)</label>
						</div>
						<div class="b-con-box" role="cell" data-bind="text: GRAD_GCD_NM"></div>
					</div>
					<div class="b-row-item">
						<div class="b-title-box" role="rowheader">
							<label data-lang>학위</label>
						</div>
						<div class="b-con-box" role="cell" data-bind="text: DEG_COURSE_GCD"></div>
					</div>
					<div class="b-row-item">
						<div class="b-title-box" role="rowheader">
							<label data-lang>학과(부)</label>
						</div>
						<div class="b-con-box" role="cell" data-bind="text: DEPT_CD_NM"></div>
					</div>
				</div>
				<div class="b-row-box" role="row">
					<div class="b-row-item">
						<div class="b-title-box" role="rowheader">
							<label data-lang>학번</label>
						</div>
						<div class="b-con-box" role="cell" data-bind="text: STDT_NO"></div>
					</div>
					<div class="b-row-item">
						<div class="b-title-box" role="rowheader">
							<label data-lang>학년</label>
						</div>
						<div class="b-con-box" role="cell" data-bind="text: STDT_YEAR_GCD"></div>
					</div>
					<div class="b-row-item">
						<div class="b-title-box" role="rowheader">
							<label data-lang>성명</label>
						</div>
						<div class="b-con-box" role="cell" data-bind="text: STDT_KOR_NM"></div>
					</div>
				</div>
				<div class="b-row-box" role="row">
					<div class="b-row-item">
						<div class="b-title-box" role="rowheader">
							<label data-lang>연락처</label>
						</div>
						<div class="b-con-box" role="cell" data-bind="text: STDT_CELLULAR_NO"></div>
					</div>
					<div class="b-row-item merge-2">
						<div class="b-title-box" role="rowheader"></div>
						<div class="b-con-box" role="cell">
							<label data-lang>※ 연락처가 변경된 경우 [학적-개인정보수정]에서 변경</label>
						</div>
					</div>
				</div>
			</div>

			<div class="card">
				<div class="card-header" id="">
					<strong>[분할 납부신청서 작성]</strong>
				</div>
				<div class="sec-body">
					<ul class="list list-style-1">
						<li class="text-primary">분할등록 신청은 2~4회까지 신청 가능합니다.</li>
						<li class="text-primary">단, 1회차는 25%이상이여야 하며 한번에 5%씩 조정이 가능합니다.</li>
					</ul>

					<div class="b-table-box flex-col-2" id="" role="table" aria-label="분할납부">
						<div class="b-row-box" role="row">
							<div class="b-row-item merge-2">
								<div class="b-title-box" role="rowheader">
									<label data-lang>분할납부<br>신청학기
									</label>
								</div>
								<div class="b-con-box" role="cell">
									<label type="hidden" id="lblYearTerm" data-bind="" /> 
								</div>
							</div>
						</div>
						<div class="b-row-box" role="row">
							<div class="b-row-item ">
								<div class="b-title-box" role="rowheader">
									<label for="DEVIDE_TIMESNO" data-lang>분할횟수</label>
								</div>
								<div class="b-con-box" role="cell">
									<select id="DEVIDE_TIMESNO" class="form-control" onchange="fn_onchange()"></select>
								</div>
							</div>
							<div class="b-row-item ">
								<div class="b-title-box" role="rowheader">
									<label data-lang>총액</label>
								</div>
								<div class="b-con-box" role="cell">
									<label type="text" id="TOTAL_AMT" data-bind="" /> 
								</div>
							</div>
							<div class="b-row-item merge-2">
								<div class="b-title-box" role="rowheader">
									<label data-lang>처리결과(신청완료,확정,확정불가) :
									</label>
								</div>
								<div class="b-con-box" role="cell">
									<label type="hidden" id="lblConfFg" data-bind="" /> 
								</div>
							</div>
						</div>
					</div>

					<!-- 테이블 -->
					<div class="table-box table-list" style = "height:350px">
						<div class="table-body">
							<table class="table table-hover" data-toggle="table" data-show-column="true">
								<caption>분할납부정보</caption>
								<colgroup>
									<col style="min-width: 100px;">
									<col style="min-width: 100px;">
									<col style="min-width: 100px;">
									<col style="min-width: 100px;">
									<col style="min-width: 100px;">
								</colgroup>
								<thead>
									<tr>
										<th scope="col" >분할횟수</th>
										<th scope="col">분할비율(%)</th>
										<th scope="col" >수업료I(원)</th>
										<th scope="col" >수업료II(원)</th>
										<th scope="col" >납부예정일자</th>
									</tr>
									
								</thead>
								<tbody id="resultTbody">
							</table>
						</div>
					</div>
					<!-- /END 테이블 -->
				</div>
			</div>
	</section>
	<div class="_footer">
		<section class="sec-1">
			<div class="sec-body">
				<div class="btn-box">
					<div class="form-row btn-box-right">
						<div class="col-auto">
							<button class="btn btn-success" id="btnUpd" type="button" data-lang onclick="javascript:return fn_inputChk('U');">수정</button>
							<button class="btn btn-danger" id="btnDel" type="button" data-lang onclick="javascript:return fn_Delete();">삭제</button>
						</div>
					</div>
				</div>
			</div>
		</section>
	</div>
</div>

<script type="text/x-tbody-template" id="resultTemplate">
	<tr id="row#:CLAIM_DEVIDE_CHASU#" class="tableList#:RN#" style="cursor:pointer;">
		<td>#:CLAIM_DEVIDE_CHASU#</td>
		<td>
			#<input type="number" id="DEVIDE_RATIO" name="DEVIDE_RATIO" class="form-control DEVIDE_RATIO" onchange="fn_onchangeRatio()" style="text-align: center" value="#:DEVIDE_RATIO#" min="0" max="100" step="5" title="분할비율"/>#
		</td>
	    <td class='text-right'>#:DEVIDE_CLASS_1_AMT#</td>
	    <td class='text-right'>#:DEVIDE_CLASS_2_AMT#</td>
	    <td>#:PAY_CLOSE_DATE#</td>
		<input type="hidden" id="CLAIM_DEVIDE_CHASU" value="#:CLAIM_DEVIDE_CHASU#"></input>
		<input type="hidden" id="DEVIDE_CLASS_1_AMT" value="#:DEVIDE_CLASS_1_AMT#"></input>
		<input type="hidden" id="DEVIDE_CLASS_2_AMT" value="#:DEVIDE_CLASS_2_AMT#"></input>
	</tr>
</script>

<script type="text/javascript">
	$(document).ready(popInit());
	var dataCnt = 0;
	var rowNum = 0;

	var rowNo = new Array();
	var rowList = new Array();
	
	var divideCnt = 0;
	
	function popInit() {
		$('#STDT_NO').val(scwin.loginUser.userId);
		fn_enYearTerm();
		/*
		$('#SYEAR').val('2023');
		$('#TERM_GCD').val('0010');
		
		if($('#TERM_GCD').val()=="0010"){
			var termNm = "1학기";
		}else {
			var termNm = "2학기";
		}
		
		$('#lblYearTerm').text($('#SYEAR').val() + "년 " + termNm);
		*/
		
		gfn_com_DropDownLists([ {
			elements : $("#DEVIDE_TIMESNO"),
			commonCode : "0001_ENROLL_ETC_GCD",
			dataTextField : "COMMON_DETAIL_CD_KOR_NM",
			dataValueField : "COMMON_DETAIL_CD",
			optionLabel : "선택",
			optionValue : "",
			defaultValue : "",
			expnCondition : "AND CHAR_1_CONTENT LIKE'%07%'",
			hakbuGradFg : false,
			dataBound : function(e) {
			}
		} ]);

		$("#btnUpd").hide();
		$("#btnDel").hide();
		
		$("input[name='DEVIDE_RATIO']").change(function() {
			fn_onchangeRatio(); //비율계산	
		});
		
	}
	
	function fn_enYearTerm(){
		var param = {};
		gfn_ajax_request({
			url : "/ost/enroll/enrollamtpayguide/devidepay/selectEnYearTerm",
			reqData : param,
			success : function(data, responseData) {
				$('#SYEAR').val(data.SYEAR);
				$('#TERM_GCD').val(data.TERM_GCD);
				
				if($('#TERM_GCD').val()=="0010"){
					var termNm = "1학기";
				}else {
					var termNm = "2학기";
				}
				
				$('#lblYearTerm').text($('#SYEAR').val() + "년 " + termNm);
				
				setInit();

			}
		});
		
	}

	/*  팝업창 로드 시 초기설정 함수 */
	function setInit() {
		fn_applyList();  	//신청내역 조회
		fn_stdtInfo();		//기본 정보 조회
	}
	
	/* 동의 체크 */
	function fn_agreeChk(){
		if($("#agree1").is(":checked") == true){
			$("#btnInput").show();	
		}else if($("#agree2").is(":checked") == true) {
			$("#btnInput").hide();
		}
	}
	
	/***************************************************************************
	 * fn_onchange  -- select 값 변할때
	 **************************************************************************/
	function fn_onchange() {
		divideCnt = parseInt($("#DEVIDE_TIMESNO").val().substr(3,1));
		
		if(divideCnt=="2"){
			$("#resultTbody tr:eq(0)").find(".DEVIDE_RATIO").val(50);
			$("#resultTbody tr:eq(1)").find(".DEVIDE_RATIO").val(50);
			$("#resultTbody tr:eq(2)").find(".DEVIDE_RATIO").val(0);
			$("#resultTbody tr:eq(3)").find(".DEVIDE_RATIO").val(0);
			$("#row3").hide();
			$("#row4").hide();
		} else if(divideCnt=="3"){
			$("#resultTbody tr:eq(0)").find(".DEVIDE_RATIO").val(35);
			$("#resultTbody tr:eq(1)").find(".DEVIDE_RATIO").val(35);
			$("#resultTbody tr:eq(2)").find(".DEVIDE_RATIO").val(30);
			$("#resultTbody tr:eq(3)").find(".DEVIDE_RATIO").val(0);
			$("#row3").show();
			$("#row4").hide();
		} if(divideCnt=="4"){
			$("#resultTbody tr:eq(0)").find(".DEVIDE_RATIO").val(25);
			$("#resultTbody tr:eq(1)").find(".DEVIDE_RATIO").val(25);
			$("#resultTbody tr:eq(2)").find(".DEVIDE_RATIO").val(25);
			$("#resultTbody tr:eq(3)").find(".DEVIDE_RATIO").val(25);
			$("#row3").show();
			$("#row4").show();
		}
			
		
		fn_onchangeRatio(); //비율계산	

	}
	var ratioSum = 0; //비율 총합계
	var ratio = 0 ; //비율
	/***************************************************************************
	 * fn_onchangeRatio  -- 분할비율  => 분할횟수가 바뀌거나 비율이 바뀔때 타야함
	 **************************************************************************/
	function fn_onchangeRatio() {
		
		var strAmt1 = "" //금액1
 		var priceChk1 = 0; //천원단위1
		var priceAll1 = 0;  // 천원 절삭1
		var firstPrice1 = 0;
		var price1 = 0;
		
		var restAmt1 = 0; // 금액1 나머지값(십원단위)
		var substrAmt1 = String(Amt1);
		
		var restAmt2 = 0; // 금액2 나머지값(십원단위)
		var substrAmt2 = String(Amt2);
				
		var strAmt2 = "" //금액2
	 	var priceChk2 = 0; //천원단위2
		var priceAll2 = 0;  // 천원 절삭2
		var firstPrice2 = 0;
		var price2 = 0;
		
		var convert_amt1 = 0;
		var convert_amt2 = 0;
		
		var substrAmt = 0;  //총금액 단위 자르기
		
		divideCnt = parseInt($("#DEVIDE_TIMESNO").val().substr(3,1));
		
		if(substrAmt1.length > 5){
			substrAmt = -4;
		}else{
			substrAmt = -3;
		}
		
		/* 십원 단위 백뷴율시 나머지값 발생 해결*/
		if(substrAmt1.substr(substrAmt1.length-2,1) != '0'){
			Amt1 = parseInt((Amt1 - parseInt(substrAmt1.substr(substrAmt1.length-2,2))));
			restAmt1 = parseInt(substrAmt1.substr(substrAmt1.length-2,2));
		}
		
		if(substrAmt2.substr(substrAmt2.length-2,1) != '0'){
			Amt2 = parseInt((Amt2 - parseInt(substrAmt2.substr(substrAmt2.length-2,2))));
			restAmt2 = parseInt(substrAmt2.substr(substrAmt2.length-2,2));
		}
		
	 	for (var i = 0; i < 4; i++) {
			ratio = parseInt($("#resultTbody tr:eq(" + i + ")").find(".DEVIDE_RATIO").val());  
			if (ratio == 0){
				$('#resultTbody tr:eq(' + i + ') td:eq(2)').text(0);
				$('#resultTbody tr:eq(' + i + ') td:eq(3)').text(0);
			}
		}  
		  
		for (var i = 0; i < divideCnt; i++) {
			ratio = parseInt($("#resultTbody tr:eq(" + i + ")").find(".DEVIDE_RATIO").val());  // 분할횟수에 따른 분할비율
			
			intAmt1 = Amt1 * ratio / 100;  // 총액에서 분할비율에 따른 값
			strAmt1 = String(Amt1 * ratio / 100);
			
			intAmt2 = Amt2 * ratio / 100;  // 총액에서 분할비율에 따른 값
			strAmt2 = String(Amt2 * ratio / 100);
			
			if(strAmt1 != "0" && i != 0) {
				priceChk1 = parseInt(strAmt1.substr(substrAmt));  //천원단위가져오기
				priceAll1 = priceAll1+ priceChk1 ;  //천원 절삭한 모든 값
				console.log("priceAll1:"+priceAll1+"//priceChk1:"+ priceChk1+"||||restAmt1:" +restAmt1)
				$('#resultTbody tr:eq(' + i + ') td:eq(2)').text(String(intAmt1-priceChk1).toString().replaceAll(/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g, ","));
			}
			else{
				$('#resultTbody tr:eq(' + i + ') td:eq(2)').text(strAmt1.toString().replaceAll(/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g, ","));
			}
			
			if(strAmt2 != "0" && i != 0) {
				priceChk2 = parseInt(strAmt2.substr(substrAmt));  //천원단위가져오기
				priceAll2 = priceAll2+ priceChk2;  //천원 절삭한 모든 값
				
				$('#resultTbody tr:eq(' + i + ') td:eq(3)').text(String(intAmt2-priceChk2).toString().replaceAll(/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g, ","));
			}
			else{
				$('#resultTbody tr:eq(' + i + ') td:eq(3)').text(strAmt2.toString().replaceAll(/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g, ","));
			}
		} 
		
		firstPrice1 = parseInt($('#resultTbody tr:eq(0) td:eq(2)').text().replaceAll(",",""));
		firstPrice2 = parseInt($('#resultTbody tr:eq(0) td:eq(3)').text().replaceAll(",",""));
		
		$('#resultTbody tr:eq(0) td:eq(2)').text(String(firstPrice1 + priceAll1 + restAmt1).toString().replaceAll(/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g, ","));  //절삭된 모든값은 1회차에 저장
		$('#resultTbody tr:eq(0) td:eq(3)').text(String(firstPrice2 + priceAll2 + restAmt2).toString().replaceAll(/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g, ","));  //절삭된 모든값은 1회차에 저장
		
	}
	
	var Amt = 0;
	var Amt1 = 0;
	var Amt2 = 0;
	scwin.dataEmpty = false;
	var confFg = "";
	/* 신청내역 조회 */
	function fn_applyList() {
		var param = gfn_com_inputdata($("#popups"));
		param.GBN = "1";
		gfn_ajax_request({
			url : "/ost/enroll/enrollamtpayguide/devidepay/selectApplyList",
			reqData : param,
			success : function(data, responseData) {
				dataCnt = data.length;
				
				var len = JSON.stringify(data.length);
				for (var i = 0; i < len; i++) {
					if(data[i].RN != "") {
						var no = data[i].RN;
						var num = i;
						rowNo.push(num);
					}
				}        

				Amt1 = (data.length >0 )?data[0].TOTAL_CLASS_1_AMT :0;
				Amt2 = (data.length >0 )?data[0].TOTAL_CLASS_2_AMT :0;
				Amt = (data.length >0 )?data[0].TOTAL_AMT :0;
				
				var totalAmt = Amt.toString().replaceAll(/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g, ",");  //숫자콤마
				var totalAmt1 = Amt1.toString().replaceAll(/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g, ",");
				var totalAmt2 = Amt2.toString().replaceAll(/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g, ",");	
				
				
				$('#TOTAL_AMT').text(totalAmt); 
				if(data.length > 0){
					$('#DEVIDE_TIMESNO').val("070"+data[0].DEVIDE_TIMESNO);	
				}
				 
				
				if(data.length < 1) {   
					$('#rowStatus').val("C");
	   		    }else{
	   		    	$('#rowStatus').val("U");
		    		$('#agree1').attr("disabled", "true");
		    		$('#agree2').attr("disabled", "true");		
		    		$('#agree1').attr("checked", "true");
		    		$("#btnInput").show();
	   		    } 

				$("#resultTbody").listView({
					dataSource : data,
					dataBound : function(e) {
						totalCnt = responseData.totCnt;
						currentData = data;
					},
					template : $("#resultTemplate"),
		            totalViewYn : "N",
					paging : null,
					emptyComment : '데이터가 존재하지 않습니다.',
					excel : null
				});
				
				//분할횟수 4만큼 미리 세팅
				for (i=dataCnt; i<4; i++){
					var html = "<tr id='row"+(i+1)+"' class=tableList " + i + "style='cursor:pointer;'>";
					html += "<td>"+(i+1)+"</td>";
					html += "<td><input type='number' id='DEVIDE_RATIO' name='DEVIDE_RATIO' class='form-control DEVIDE_RATIO' onchange='fn_onchangeRatio()' style='text-align: center' value='' min='0' max='100' step='5' title='분할비율'></input></td>";
					html += "<td class='text-right'></td>";
					html += "<td class='text-right'></td>";
					html += "<td></td>";
					html += "</tr>";
					$("#resultTbody").append(html);
				}		
				
				
				var param = gfn_com_inputdata($("#popups"));
				param.GBN = "2";
				gfn_ajax_request({
					url : "/ost/enroll/enrollamtpayguide/devidepay/selectApplyList",
					reqData : param,
					success : function(data, responseData) {
						for (i=dataCnt; i<4; i++){
							$('#resultTbody tr:eq('+i+') td:eq(4)').text(data[i].PAY_CLOSE_DATE);
						}						
					}
				})

				document.getElementById('DEVIDE_RATIO').min ='25'
				
				
				if(data.length > 0){
					if(data[0].DEVIDE_TIMESNO == "2"){
						$("#row3").hide();
						$("#row4").hide();
					}else if(data[0].DEVIDE_TIMESNO == "3"){
						$("#row3").show();
						$("#row4").hide();
					}else if(data[0].DEVIDE_TIMESNO == "4"){
						$("#row3").show();
						$("#row4").show();
					}
				}
				
				var appendHtml = "<tr style='cursor:pointer;'>";
				appendHtml += "<td>합</td>";
				appendHtml += "<td>100</td>";
				appendHtml += "<td class='text-right'>"+ totalAmt1 +"</td>";
				appendHtml += "<td class='text-right'>"+ totalAmt2 +"</td>";
				appendHtml += "<td></td>";
				appendHtml += "</tr>";
				$("#resultTbody").append(appendHtml);
				$("#resultTbody tr:last").css("background-color", "rgba(255, 255, 0, .080)");
				
				if(data.length > 0){
					scwin.dataEmpty = true;
					confFg = data[0].APPLY_PROCESS_GCD;
					$('#lblConfFg').text(data[0].CONFIRM_FG);
				}else{
					scwin.dataEmpty = false;
				}
				
				fn_popChkApply(data);
				fn_onchangeRatio(); 
				
			}
		});
	}
	
	/* 가능기간 조회 */
	function fn_popChkApply(dt) {
		//var param = gfn_com_inputdata($("#popups"));
		var param = {};

		gfn_ajax_request({
			url : "/ost/enroll/enrollamtpayguide/devidepay/selectChkApply",
			reqData : param,
			success : function(data, responseData) {
				if(dt.length == 0){
					if(data.신청가능날짜  == "가능"){

					}
				}else{
					if(data.신청가능날짜  == "가능"){
						//분할횟수 , 확정여부 세팅
						$("#btnUpd").show();
						$("#btnDel").show();
					}
				} 
				
				/* test */
				//$("#btnApply").show();
				//$("#btnUpd").show();
				//$("#btnDel").show();
			}
		});
	}
	
	
	/* 기본정보 조회 */
	function fn_stdtInfo() {
		var searchParam = {};
		
		gfn_ajax_request({
			url : "/ost/enroll/enrollamtpayguide/devidepay/selectStdtInfo",
			reqData : searchParam,
			success : function(data, responseData) {
				
				gfn_com_dataBind($("#popups"), data);
			}
		});
		
	}

	
	/* 입력가능체크 */
	function fn_inputChk(rowStatus) {
		$('#rowStatus').val(rowStatus);
		ratioSum = 0;
		
		divideCnt = parseInt($("#DEVIDE_TIMESNO").val().substr(3,1));

		if($('#DEVIDE_TIMESNO').val()== ""){
			alert("분할 횟수를 선택하셔아 합니다.");
			return;
		} 
		
		for (var i = 0; i<divideCnt; i++) {
			ratioSum = ratioSum + parseInt($("#resultTbody tr:eq(" + i + ")").find(".DEVIDE_RATIO").val());
		}
		
		if(ratioSum>100 || ratioSum < 100) {
			alert("분할비율이 맞지 않습니다. (분할비율 : 100%)");
			ratioSum = 0;
			return;
		}
		
		var param = gfn_com_inputdata($("#popups"));
		gfn_ajax_request({
			url : "/ost/enroll/enrollamtpayguide/devidepay/selectInputChk",
			reqData : param,
			success : function(data, responseData) {
				if(data.MSGDLGTYPE == "OK"){
				/*	if(rowStatus == 'C'){
						fn_Apply();
					}else */
					if(rowStatus == 'U'){
						fn_Update();
					}
				}else{
					alert(data.MSG);			
				}
			}
		});
		
	}
	
	/* 신청 */
	/*function fn_Apply() {
		$('#rowStatus').val("C");
	
		var data = new Array();
		
		for (var i = 0; i<divideCnt; i++) {
			var map = gfn_com_inputdata($(".tableList"+rowNo[i]));
			data.push(map);
			
			data[i].SYEAR = $('#SYEAR').val();
			data[i].TERM_GCD = $('#TERM_GCD').val();
			data[i].DEVIDE_TIMESNO = $('#DEVIDE_TIMESNO').val();
			data[i].STDT_NO = $('#STDT_NO').val();
			data[i].rowStatus = $('#rowStatus').val();
			data[i].CLAIM_DEVIDE_CHASU = i+1;
			data[i].DEVIDE_RATIO = $("#resultTbody tr:eq(" + i + ")").find(".DEVIDE_RATIO").val();
			data[i].DEVIDE_CLASS_1_AMT = $('#resultTbody tr:eq(' + i + ') td:eq(2)').text().replaceAll(",","");
			data[i].DEVIDE_CLASS_2_AMT = $('#resultTbody tr:eq(' + i + ') td:eq(2)').text().replaceAll(",","");
			
		}
		
		gfn_ajax_request({
			url : "/ost/enroll/enrollamtpayguide/devidepay/executeDevidePay",
	        reqData : data,
	        success : function(data, responseData) {
	        	alert('신청되었습니다.');
	        	
	        	gfn_com_closeModalWall();  //팝업닫기
	        }
	    });  
		
	}*/
	
	/* 입력(수정) */
	function fn_Update() {
		$('#rowStatus').val("U");


		var data = new Array();
		var saveCnt = 0;
		
		if(dataCnt<divideCnt){  //분할횟수 늘림
			saveCnt = divideCnt;
		}
		else if(dataCnt>divideCnt){ //분할횟수 줄어듦
			saveCnt = dataCnt;
		}else{
			saveCnt = divideCnt;
		}
		
		for (var i = 0; i<saveCnt; i++) {
			var map = gfn_com_inputdata($(".tableList"+rowNo[i]));
			data.push(map);

			data[i].SYEAR = $('#SYEAR').val();
			data[i].TERM_GCD = $('#TERM_GCD').val();
			data[i].DEVIDE_TIMESNO = $('#DEVIDE_TIMESNO').val();
			data[i].rowStatus = $('#rowStatus').val();
			data[i].CLAIM_DEVIDE_CHASU = i+1;
			data[i].DEVIDE_RATIO = $("#resultTbody tr:eq(" + i + ")").find(".DEVIDE_RATIO").val();
			data[i].DEVIDE_CLASS_1_AMT = $('#resultTbody tr:eq(' + i + ') td:eq(2)').text().replaceAll(",","");
			data[i].DEVIDE_CLASS_2_AMT = $('#resultTbody tr:eq(' + i + ') td:eq(3)').text().replaceAll(",","");
			
		}

		gfn_ajax_request({
			url : "/ost/enroll/enrollamtpayguide/devidepay/executeDevidePay",
	        reqData : data,
	        success : function(data, responseData) {
	        	alert('신청되었습니다.');
	        	
	        	gfn_com_closeModalWall(1,fn_chkTuition());   //팝업닫기
	        }
	    });  
	}
	
	/* 삭제 */
	function fn_Delete() {
		if (!scwin.dataEmpty) return; //신청내역 데이터가 없을경우 리턴
		
		$('#rowStatus').val("D");
		
		var param = gfn_com_inputdata($("#popups"));
		
		if(confFg == "0004"){
			 gfn_ajax_request({
					url : "/ost/enroll/enrollamtpayguide/devidepay/deleteDevidePay",
			        reqData : param,
			        success : function(data, responseData) {
			        	alert("분할신청 취소처리가 정상적으로 완료되었습니다.");

			        	gfn_com_closeModalWall(1,fn_chkTuition());   //팝업닫기
			        }
			    }); 
			 
		}else{
			alert("이미 분할신청 처리가 확정되어 취소할수 없습니다.");
		}
		
	}
	
	
</script>