<div id="popups">
	<section class="sec-1">
		<div class="sec-body">
			<div class="b-table-box flex-col-3" id="stdtTable" role="table" aria-label="학적정보 테이블">
				<div class="b-row-box" role="row">
					<div class="b-row-item merge-3">
						<div class="b-title-box" role="rowheader">
							<label data-lang>소속(과정)</label>
						</div>
						<div class="b-con-box" role="cell">
							<span data-bind="text: DEPT_NM"></span>
						</div>
					</div>
				</div>
				<div class="b-row-box" role="row">
					<div class="b-row-item">
						<div class="b-title-box" role="rowheader">
							<label data-lang>학번(성명)</label>
						</div>
						<div class="b-con-box" role="cell">
							<span data-bind="text: STDT_INFO"></span>
							<input type="hidden" id="STDT_NO" data-bind="value: STDT_NO" />
						</div>
					</div>
					<div class="b-row-item">
						<div class="b-title-box" role="rowheader">
							<label id="lbl_STDT_YEAR_NM" data-lang>학년</label>
						</div>
						<div class="b-con-box" role="cell">
							<span data-bind="text: STDT_YEAR_NM"></span>
						</div>
					</div>
					<div class="b-row-item">
						<div class="b-title-box" role="rowheader">
							<label data-lang>학적상태</label>
						</div>
						<div class="b-con-box" role="cell">
							<span data-bind="text: HJ_STA_NM"></span>
						</div>
					</div>
				</div>
				<div class="b-row-box" role="row">
					<div class="b-row-item merge-prev">
						<div class="b-title-box" role="rowheader">
							<label data-lang>누적휴학학기수</label>
						</div>
						<div class="b-con-box" role="cell">
							<span data-bind="text: HYUHAK_ACC_CNT"></span>
						</div>
					</div>
					<div class="b-row-item merge-2">
						<div class="b-title-box" role="rowheader">
							<label data-lang>휴학가능학기수</label>
						</div>
						<div class="b-con-box" role="cell">
							<span data-bind="text: HYUHAK_CNT"></span>
						</div>
					</div>
				</div>
			</div>
			<div class="b-table-box flex-col-2" id="stdtTable" role="table" aria-label="변경사항 테이블">
				<div class="b-row-box" role="row">
					<div class="b-row-item merge-2">
						<div class="b-title-box" role="rowheader">
							<label class="req" data-lang>신청학년도/학기</label>
						</div>
						<div class="b-con-box" role="cell">
							<span data-bind="text: APPLY_SYEAR_TERM"></span>
							<input type="hidden" id="CHG_SEQ_NO" data-bind="value: CHG_SEQ_NO" />
						</div>
					</div>
				</div>
				<div class="b-row-box" role="row">
					<div class="b-row-item">
						<div class="b-title-box" role="rowheader">
							<label class="req" data-lang>휴학사유</label>
						</div>
						<div class="b-con-box" role="cell">
							<div class="form-check form-check-inline">
								<input class="form-check-input" type="radio" name="CHG_APPLY_REASON_GCD" id="radio1" value="0001" data-bind="checked: CHG_APPLY_REASON_GCD"
									checked>
								<label class="form-check-label mr-2" for="radio1" data-lang>일반휴학(개인사정)</label>
								<input class="form-check-input" type="radio" name="CHG_APPLY_REASON_GCD" id="radio2" value="0006" data-bind="checked: CHG_APPLY_REASON_GCD">
								<label class="form-check-label mr-2" for="radio2" data-lang>병역휴학</label>
							</div>
						</div>
					</div>
					<div class="b-row-item">
						<div class="b-con-box text-primary align-items-center" role="cell">
							<span class="info-text" data-lang> 그 외 휴학사유는 학과 사무실 방문 신청</span>
						</div>
					</div>
				</div>
				<div class="b-row-box" role="row" id="milStartDateRow">
					<div class="b-row-item merge-2">
						<div class="b-title-box" role="rowheader">
							<label class="req" for="MIL_START_DATE" data-lang>입대일자</label>
						</div>
						<div class="b-con-box" role="cell">
							<div class="row">
								<div class="col-8">
									<input type="text" id="MIL_START_DATE" class="form-control datepicker" data-bind="value: MIL_START_DATE_FORMAT" />
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="b-row-box" role="row" id="milClassGcdRow">
					<div class="b-row-item merge-2">
						<div class="b-title-box" role="rowheader">
							<label class="req" for="MIL_CLASS_GCD" data-lang>병역구분</label>
						</div>
						<div class="b-con-box" role="cell">
							<div class="row">
								<div class="col-5">
									<select id="MIL_CLASS_GCD" class="form-control"  data-bind="selected: MIL_CLASS_GCD"></select>
								</div>
								<div class="col-3">
									<select id="MIL_SERVE_BM_CNT" class="form-control" title="병역기간"></select>
								</div>
								<div class="col-2">
									<input type="text" class="form-control numeric" maxlength="2" id="MIL_SERVE_BM_CNT_TXT" title="병역기간 직접입력" />
								</div>
								<div class="col-2 mt-2">
									<label data-lang>개월</label>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="b-row-box" role="row">
					<div class="b-row-item merge-2">
						<div class="b-title-box" role="rowheader">
							<label data-lang>휴학기간</label>
						</div>
						<div class="b-con-box" role="cell" aria-colspan="3">
							<div class="row">
								<div class="col-xl-12">
									<p>
										<span id="startSyear" data-bind="text: APPLY_SYEAR"></span>학년도 &nbsp;<span id="startTermNm" data-bind="text: APPLY_TERM_NM"></span>부터
										<input type="hidden" id="APPLY_SYEAR" data-bind="value: APPLY_SYEAR" />
										<input type="hidden" id="APPLY_TERM_GCD" data-bind="value: APPLY_TERM_GCD" />

									</p>
								</div>
								<div class="col-xl-12">
									<p id="hyuhakSupposeTxt">
										<span id="endSyear" data-bind="text: SUPPOSE_SYEAR"></span>학년도 &nbsp;<span id="endTermNm" data-bind="text: SUPPOSE_TERM_NM"></span>까지
									</p>
									<p id="milSupposeTxt">
										<span id="milEndSyear" data-bind="text: SUPPOSE_SYEAR"></span>학년도 &nbsp;<span id="milEndTermNm" data-bind="text: SUPPOSE_TERM_NM"></span>까지
									</p>
									<input type="hidden" id="SUPPOSE_SYEAR" data-bind="value: SUPPOSE_SYEAR" />
									<input type="hidden" id="SUPPOSE_TERM_GCD" data-bind="value: SUPPOSE_TERM_GCD" />
								</div>
								<div class="col-xl-6" id="hyuhakTermCntRow">
									<div class="form-row" style="flex-wrap: nowrap;">
										<span class="mr-1">(</span> <select id="HYUHAK_TERM_CNT" class="form-control" style="width: 60%;" data-bind="selected: HYUHAK_TERM_CNT"
											title="휴학학기수">
										</select><span class="ml-1">) 학기간</span>
									</div>
								</div>
							</div>

						</div>
					</div>
				</div>
				<div class="b-row-box" role="row">
					<div class="b-row-item merge-2">
						<div class="b-title-box" role="rowheader">
							<label class="req" for="STDT_ZIP_NO" data-lang>주소</label>
						</div>
						<div class="b-con-box" role="cell">
							<div class="row">
								<div class="col-xl-2">
									<input type="text" class="form-control numeric" id="STDT_ZIP_NO" data-bind="value: STDT_ZIP_NO" readonly="readonly"/>
								</div>
								<div class="col-auto ml-1">
									<button class="btn btn-primary" onclick="fn_jusoPop()" type="button">우편번호 검색</button>
								</div>
								<div class="col-xl-12">
									<input type="text" class="form-control" id="STDT_ADDR" data-bind="value: STDT_ADDR" title="주소" readonly="readonly" />
								</div>
								<div class="col-xl-12">
									<input type="text" class="form-control" id="STDT_DETAIL_ADDR" data-bind="value: STDT_DETAIL_ADDR" title="상세주소" />
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="b-row-box" role="row">
					<div class="b-row-item merge-2">
						<div class="b-title-box" role="rowheader">
							<label class="req" for="STDT_EMAIL" data-lang>이메일</label>
						</div>
						<div class="b-con-box" role="cell">
							<div class="row">
								<div class="col-xl-12">
									<input type="text" class="form-control" id="STDT_EMAIL" data-bind="value: STDT_EMAIL" />
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="b-row-box" role="row">
					<div class="b-row-item">
						<div class="b-title-box" role="rowheader">
							<label class="req" for="STDT_CELLULAR_NO" data-lang>본인 휴대폰</label>
						</div>
						<div class="b-con-box" role="cell">
							<div class="row">
								<div class="col-xl-12">
									<input type="text" class="form-control" id="STDT_CELLULAR_NO" data-bind="value: CELLULAR_NO" />
								</div>
							</div>
						</div>
					</div>
					<div class="b-row-item">
						<div class="b-con-box text-primary text-right" role="cell">
							<span class="info-text" data-lang>입력하신 휴대폰번호로 신청처리결과를 안내드리니 정확히 입력하시기 바랍니다.</span>
						</div>
					</div>
				</div>
				<div class="b-row-box" role="row">
					<div class="b-row-item merge-2">
						<div class="b-title-box" role="rowheader">
							<label for="STDT_TEL_NO" data-lang>본인 전화번호</label>
						</div>
						<div class="b-con-box" role="cell">
							<div class="row">
								<div class="col-xl-12">
									<input type="text" class="form-control" id="STDT_TEL_NO" data-bind="value: CELLULAR_NO" />
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="b-row-box" role="row" id="fileRow">
					<div class="b-row-item merge-2">
						<div class="b-title-box" role="rowheader">
							<label class="req" data-lang>첨부파일</label>
						</div>
						<div class="b-con-box" role="cell">
							<div class="sec-body" id="uploader_target1"></div>
							<input type="hidden" id="ATTACH_FILE_GRP_CD" data-bind="value: ATTACH_FILE_GRP_CD" />
						</div>
					</div>
				</div>
			</div>
			<header class="mt-5">
				<h4 class="sec-title text-center mb-5">위와 같이 휴학하고자 하오니 허가하여 주시기 바랍니다.</h4>
				<h6 class="sec-title text-center mt-5">
					<span data-bind="text: APPLY_YEAR"></span>년 <span data-bind="text: APPLY_MONTH"></span>월 <span data-bind="text: APPLY_DAY"></span>일
				</h6>
				<p class="text-right">
					<span>본 인 : &nbsp;</span><span id="userNm" data-bind="text: STDT_KOR_NM"></span>
				</p>
				<h4 class="sec-title text-left mt-2">부산대학교 총장 귀하</h4>
			</header>
			<div class="_footer">
				<section class="sec-1">
					<div class="sec-body">
						<div class="btn-box">
							<div class="form-row btn-box-right">
								<div class="col-auto">
									<button class="btn btn-primary" id="btnSubmit" type="button" data-lang onclick="javascript:return fn_applySave('S');">제출</button>
									<button class="btn btn-danger" id="btnCancel" type="button" data-lang onclick="javascript:return fn_applySave('C');">신청취소</button>
								</div>
							</div>
						</div>
					</div>
				</section>
			</div>
		</div>
	</section>
</div>
<script type="text/javascript">
	$(document).ready(popInit());
	/* 전역변수 */
	var btnFlag = ""; // 수정버튼 : update, 신청취소버튼 : cancel 
	
	function popInit() {	
		setBindFn();
		setInit();
		
		/* 병역구분 코드 */
		$("#MIL_CLASS_GCD").dropDownList({
			dataSource : null,
			commonCode : "0001_MIL_CLASS_GCD",
			dataTextField : "COMMON_DETAIL_CD_KOR_NM",
			dataValueField : "COMMON_DETAIL_CD",
			optionLabel : "선택",
			optionValue : "",
			defaultValue : scwin.detailObj.MIL_CLASS_GCD,
			expnCondition : "",
			dataBound : function(e) {
				/*  병역구분 변경 시 이벤트 */
				$("#MIL_CLASS_GCD").change(function() {
					var milStartDate = gfn_str_parseNull($("#MIL_START_DATE").val().replace(/-/g, ''));
					if (milStartDate == "") {
						alert('입대일자를 먼저 입력해주세요.', $('MIL_START_DATE'));
						$("#MIL_CLASS_GCD").val("");
						return;
					}
					$("#MIL_SERVE_BM_CNT").val("");
					$("#MIL_SERVE_BM_CNT_TXT").val("");
		
					milBokhakSyearTem();
				});
			}
		});

		$("#MIL_SERVE_BM_CNT").dropDownList({
			dataSource : scwin.milServeBmList,
			dataTextField : "MIL_SERVE_BM_CNT_NM",
			dataValueField : "MIL_SERVE_BM_CNT",
			optionLabel : "직접입력",
			optionValue : "",
			defaultValue : "",
			expnCondition : "",
			dataBound : function(e) {
			}
		});

		$("#STDT_CELLULAR_NO").telEditor({
			txtVal : gfn_str_parseNull(scwin.detailObj.STDT_CELLULAR_NO_TXT),
			originVal : scwin.detailObj.STDT_CELLULAR_NO,
			telnoGbn : "C", /* 휴대폰번호 : C, 전화번호(팩스) : T, ALL : A */
			telnoNm : "휴대폰번호",
			callbackFunc : function(e) {

			},
			dataBound : function(e) {

			}
		});

		$("#STDT_TEL_NO").telEditor({
			txtVal : gfn_str_parseNull(scwin.detailObj.STDT_TEL_NO_TXT),
			originVal : scwin.detailObj.STDT_TEL_NO,
			telnoGbn : "T", /* 휴대폰번호 : C, 전화번호(팩스) : T, ALL : A */
			telnoNm : "휴대폰번호",
			callbackFunc : function(e) {

			},
			dataBound : function(e) {

			}
		});

		$("#STDT_EMAIL").emailEditor({
			val : gfn_str_parseNull(scwin.detailObj.STDT_EMAIL),
			callbackFunc : function(e) {

			},
			dataBound : function(e) {

			}
		});
	}

	/*  팝업창 로드 시 초기설정 함수 */
	function setInit() {
		
		// 휴학가능학기수에 따른 휴학기간 처리
		$("#HYUHAK_TERM_CNT").empty();
		for(var i=1; i<=scwin.detailObj.HYUHAK_CNT; i++) {
			$("#HYUHAK_TERM_CNT").append("<option value="+i+">"+i+"</option>");
		}
		
		gfn_com_dataBind($("#popups"), scwin.detailObj, '', function(e) {
			if (scwin.rowState == "C") {
				$("input:radio[name=CHG_APPLY_REASON_GCD]:radio[value='0001']").prop('checked', true);
				$("#btnCancel").hide();
			} else if (scwin.rowState == "U") {
				$("input:radio[name=CHG_APPLY_REASON_GCD]").attr("disabled", true);
				if (scwin.detailObj.MIL_SERVE_BM_CNT != "") {
					$("#MIL_SERVE_BM_CNT_TXT").attr("disabled", false);
					$("#MIL_SERVE_BM_CNT_TXT").val(scwin.detailObj.MIL_SERVE_BM_CNT);
				} else {
					$("#MIL_SERVE_BM_CNT_TXT").attr("disabled", true);
				}
			}

			if ($("input[name=CHG_APPLY_REASON_GCD]:checked").val() == "0001") {
				$("#milEndSyear").text(scwin.detailObj.APPLY_SYEAR);
				$("#milEndTermNm").text(scwin.detailObj.APPLY_TERM_NM);
				$("#milStartDateRow").hide();
				$("#milClassGcdRow").hide();
				$("#milSupposeTxt").hide();
				$("#fileRow").hide();
			} else {
				$("#endSyear").text(scwin.detailObj.APPLY_SYEAR);
				$("#endTermNm").text(scwin.detailObj.APPLY_TERM_NM);
				$("#hyuhakSupposeTxt").hide();
				$("#hyuhakTermCntRow").hide();

			}

			// 대학일 때는 학년, 대학원일 때는 학기
			if (scwin.loginUser.collGradGcd == "0001") {
				$("#lbl_STDT_YEAR_NM").html("학년");
			} else {
				$("#lbl_STDT_YEAR_NM").html("학기");
			}

			// 성별이 여자일 때는 휴학사유 DISABLED 처리
			if (scwin.loginUser.genderGcd == "0002") {
				$("input:radio[name=CHG_APPLY_REASON_GCD]:radio[value='0001']").prop('checked', true);
				$("input:radio[name=CHG_APPLY_REASON_GCD]").attr("disabled", true);

			}
		});
	}

	/* 이벤트 바인딩 함수 */
	function setBindFn() {
		// 휴학사유 변경 시 이벤트
		$("input[name=CHG_APPLY_REASON_GCD]").change(function() {
			var chgApplyReasonGcd = $(this).val();
			// 일반휴학(개인사정) 선택 시
			if (chgApplyReasonGcd == "0001") {
				$("#milStartDateRow").hide();
				$("#milClassGcdRow").hide();
				$("#fileRow").hide();
				$("#hyuhakSupposeTxt").show();
				$("#milSupposeTxt").hide();
				$("#hyuhakTermCntRow").show();
			} else {
				$("#milStartDateRow").show();
				$("#milClassGcdRow").show();
				$("#fileRow").show();
				$("#hyuhakSupposeTxt").hide();
				$("#milSupposeTxt").show();
				$("#hyuhakTermCntRow").hide();
			}
		});

		/*  휴학기간 변경 시 이벤트 */
		$("#HYUHAK_TERM_CNT").change(function() {
			var hyuhakTermCnt = $(this).val();
			var applySyear = $("#APPLY_SYEAR").val();
			var applyTermGcd = $("#APPLY_TERM_GCD").val();
			var term = "";
			var rtnTerm = "";

			if (applyTermGcd == "0010") {
				term = "0";
			} else if (applyTermGcd == "0020") {
				term = "5";
			}
			var tempYear = Number(applySyear.toString() + term.toString()) + Number(hyuhakTermCnt) * 5 + "";
			var rtnYear = tempYear.substr(0, 4);

			if (tempYear.substr(4, 1) == "0") {
				$("#endSyear").text(Number(rtnYear - 1));
				$("#endTermNm").text("2학기");

				$("#SUPPOSE_SYEAR").val($("#endSyear").text());
				$("#SUPPOSE_TERM_GCD").val("0020");
			} else {
				$("#endSyear").text(Number(rtnYear));
				$("#endTermNm").text("1학기");

				$("#SUPPOSE_SYEAR").val($("#endSyear").text());
				$("#SUPPOSE_TERM_GCD").val("0010");
			}
		});

		/*  입대일자 변경 시 이벤트 */
		$("#MIL_START_DATE").change(function() {
			milBokhakSyearTem();
		});

		/*  병역구분 변경 시 이벤트 */
// 		$("#MIL_CLASS_GCD").change(function() {
// 			if(bindFlag) {
// 				var milStartDate = gfn_str_parseNull($("#MIL_START_DATE").val().replace(/-/g, ''));
// 				if (milStartDate == "") {
// 					alert('입대일자를 먼저 입력해주세요.', $('MIL_START_DATE'));
// 					$("#MIL_CLASS_GCD").val("");
// 					return;
// 				}
// 				$("#MIL_SERVE_BM_CNT").val("");
// 				$("#MIL_SERVE_BM_CNT_TXT").val("");
	
// 				milBokhakSyearTem();
// 			}
// 		});

		/*  복무기간 변경 시 이벤트 */
		$("#MIL_SERVE_BM_CNT").change(function() {
			$("#MIL_SERVE_BM_CNT_TXT").val($(this).val());
			var milStartDate = gfn_str_parseNull($("#MIL_START_DATE").val().replace(/-/g, ''));
			if (milStartDate == "") {
				alert('입대일자를 먼저 입력해주세요.', $('MIL_START_DATE'));
				$("#MIL_SERVE_BM_CNT").val("").prop("selected", true);
				$("#MIL_SERVE_BM_CNT_TXT").val("");
				return;
			}

			var milClassGcd = gfn_str_parseNull($("#MIL_CLASS_GCD").val());
			if (milClassGcd == "") {
				alert('병역구분을 먼저 선택해주세요.', $('#MIL_CLASS_GCD'));
				$("#MIL_SERVE_BM_CNT").val("").prop("selected", true);
				$("#MIL_SERVE_BM_CNT_TXT").val("");
				return;
			}
			milBokhakSyearTem();
		});

		/*  복무기간 직접입력 변경 시 이벤트 */
		$("#MIL_SERVE_BM_CNT_TXT").change(function() {
			var milStartDate = gfn_str_parseNull($("#MIL_START_DATE").val().replace(/-/g, ''));
			if (milStartDate == "") {
				alert('입대일자를 먼저 입력해주세요.', $('MIL_START_DATE'));
				$("#MIL_SERVE_BM_CNT").val("").prop("selected", true);
				$("#MIL_SERVE_BM_CNT_TXT").val("");
				return;
			}
			
			var milClassGcd = gfn_str_parseNull($("#MIL_CLASS_GCD").val());
			if (milClassGcd == "") {
				alert('병역구분을 먼저 선택해주세요.', $('#MIL_CLASS_GCD'));
				$("#MIL_SERVE_BM_CNT").val("").prop("selected", true);
				$("#MIL_SERVE_BM_CNT_TXT").val("");
				return;
			}
			milBokhakSyearTem();
		});
	}

	function fn_jusoPop() {
		gfn_com_openJusoPop({
			callbackFunc : function(e) {
				$("#STDT_ZIP_NO").val(e.zipCd);
				$("#STDT_ADDR").val(e.addr);
				$("#STDT_DETAIL_ADDR").val("").focus();
			}
		});
	}

	/* 군휴학 종료학년도 학기 계산 */
	function milBokhakSyearTem() {
		if ($("#MIL_SERVE_BM_CNT").val() == "") { // 직접입력						
			$("#MIL_SERVE_BM_CNT_TXT").attr("disabled", false);
		} else {
			$("#MIL_SERVE_BM_CNT_TXT").attr("disabled", true);
		}

		var milStartDate = new Date($("#MIL_START_DATE").val()); // 입대일자
		var milServeBmCnt = Number($("#MIL_SERVE_BM_CNT_TXT").val()); // 복무개월 수

		milStartDate.setMonth(milStartDate.getMonth() + milServeBmCnt);

		var milStartSyear = milStartDate.getFullYear();
		var milStartMonth = milStartDate.getMonth() + 1;

		var milStartTermGcd = "";
		var milStartTermNm = "";

		console.log(milStartSyear);
		console.log(milStartMonth);
		
		console.log(milStartSyear);
		console.log(milStartTermGcd);
		
		/* 복학예정학년도 학기 계산 방식
		if (milStartMonth <= 2) { // 2월 이전 제대 시
			milStartTermGcd = "0010";
			milStartTermNm = "1학기";
		} else if (milStartMonth >= 3 && milStartMonth <= 8) { // 3~8월 제대 시
			milStartTermGcd = "0020";
			milStartTermNm = "2학기";
		} else if (milStartMonth >= 9) { // 9월 이후 제대 시
			milStartSyear = milStartSyear + 1;
			milStartTermGcd = "0010";
			milStartTermNm = "1학기";
		}*/

		//휴학 종료학년도 학기 계산 방식
		if (milStartMonth <= 2) { // 2월 이전 제대 시
			milStartSyear = milStartSyear - 1;
			milStartTermGcd = "0020";
			milStartTermNm = "2학기";
		} else if (milStartMonth >= 3 && milStartMonth <= 8) { // 3~8월 제대 시
			milStartTermGcd = "0010";
			milStartTermNm = "1학기";
		} else if (milStartMonth >= 9) { // 9월 이후 제대 시
			milStartTermGcd = "0020";
			milStartTermNm = "2학기";
		}		
		
		console.log(milStartSyear);
		console.log(milStartTermGcd);
		
		$("#milEndSyear").text(Number(milStartSyear));
		$("#milEndTermNm").text(milStartTermNm);

		$("#SUPPOSE_SYEAR").val(milStartSyear);
		$("#SUPPOSE_TERM_GCD").val(milStartTermGcd);
	}

	/* 필수입력 체크 */
	function fn_validate(param) {
		var rtnValue = true;
		var valObj = [];

		if ($("input:radio[name=CHG_APPLY_REASON_GCD]:checked").val() == "0006") {
			valObj.push({
				"id" : "MIL_START_DATE",
				"name" : "입대일자",
				"notNull" : true,
			}, {
				"id" : "MIL_CLASS_GCD",
				"name" : "병역구분",
				"notNull" : true,
			}, {
				"id" : "MIL_SERVE_BM_CNT_TXT",
				"name" : "복무개월수",
				"notNull" : true,
			}, {
				"id" : "MIL_SERVE_BM_CNT_TXT",
				"name" : "복무개월수",
				"notNull" : true,
			});

		}
		valObj.push({
			"id" : "STDT_ZIP_NO",
			"name" : "우편번호",
			"notNull" : true,
		}, {
			"id" : "STDT_ADDR",
			"name" : "주소",
			"notNull" : true,
		}, {
			"id" : "STDT_DETAIL_ADDR",
			"name" : "상세주소",
			"notNull" : true,
		}, {
			"id" : "STDT_EMAIL",
			"name" : "이메일",
			"notNull" : true,
		}, {
			"id" : "STDT_CELLULAR_NO",
			"name" : "본인휴대폰",
			"notNull" : true,
		});

		rtnValue = gfn_val_validateDataMap(param, valObj);

		if (!rtnValue)
			return rtnValue;

		return rtnValue;
	}

	/* 기타 유효성 체크 */
	function fn_validateEtc() {
		if ($("input:radio[name=CHG_APPLY_REASON_GCD]:checked").val() == "0006") {
			if ($("#uploader_target1").find(".attach-list li").length < 1) {
				alert("첨부파일은 필수 입력 사항 입니다.");
				return;
			}
		}
		return true;
	}
	
	var param = [];

	/* 저장 함수 */
	function fn_applySave(type) {
		if ($("input:radio[name=CHG_APPLY_REASON_GCD]:checked").val() == "0006") {
			$("#ATTACH_FILE_GRP_CD").val($("#uploader_target1").find("#file_1").attr('attach_file_grp_cd'));
		}

		var confirmMsg = gva_SAVE_CONFIRM_MSG;
		param = gfn_com_inputdata($("#popups"));

		if (!fn_validate(param))
			return false;

		if (!fn_validateEtc())
			return false;

		// 제출, 신청취소 버튼 클릭에 따른 처리
		if (scwin.rowState == "U") {
			if (type == "S") {
				btnFlag = "update";
			} else {
				btnFlag = "cancel";
				confirmMsg = "신청 취소하시겠습니까?";
			}
		}

		confirm(confirmMsg, function(_flag) {
			if (_flag) {
				// 수정 :  rowState = "U", 신청취소 : rowState = "D"
				if (btnFlag == "update") {
					param["rowState"] = "U";
				} else if (btnFlag == "cancel") {
					param["rowState"] = "D";
				} else {
					param["rowState"] = scwin.rowState;
				}
				param["MIL_SERVE_BM_CNT"] = $("#MIL_SERVE_BM_CNT").val() != "" ? $("#MIL_SERVE_BM_CNT").val() : $("#MIL_SERVE_BM_CNT_TXT").val();
				param["MIL_START_DATE"] = param.MIL_START_DATE.replace(/-/gi, "");
				
				/* 신청취소 일 때는 휴학가능 여부 체크 안함 */
				if(type == "S") {
					fn_selectHyuhakPossibleYn();
				}else {
					fn_applySaveCallback(); 
				}
				
			}
		});
	}

	/* 휴학가능여부 조회 */
	function fn_selectHyuhakPossibleYn() {

		/* ajax처리 */
		gfn_ajax_request({
			url : "/ost/hj/hjchnge/hyuhakApply/selectHyuhakPosibleYn",
			reqData : param,
			success : function(data, responseData) {
				if (data.O_RSLT == "N") {
					alert(data.O_MSG);
					return;
				} else {
					if(scwin.rowState == "C") {
						fn_clause();
					}else {
						fn_applySaveCallback(); 
					}	
				}
			}
		});
	}
	
	/* 약관 동의 */
	function fn_clause() {
		gfn_com_clausePop({
			title : '정보동의팝업',
			systemGcd : '0002',
			clauseSeqNo : 34,
			callbackFunc : function(data) {
				/* 필수동의 사항에 동의한 경우 콜백 실행 */
				param["agreeDltInfo"] = data; // 전달 파라미터에 정보동의 정보 담기	

				fn_applySaveCallback(); 
			}
		});
	}	
	
	/* 휴학신청 저장 */
	function fn_applySaveCallback() {		
		gfn_ajax_request({
			url : "/ost/hj/hjchnge/hyuhakApply/executeHyuhakApply",
			reqData : param,
			success : function(data, responseData) {
				alert(data.O_MSG);
				// 신청 완료
				if (data.O_RSLT == "Y") {
					var attach_file_grp_cd = $("#ATTACH_FILE_GRP_CD").val();
					fn_fileComplete(attach_file_grp_cd);
					gfn_com_closeModalWall(1, function() {
						fn_sch();
					});
				}
			}
		});
	}


	/* 신규 신청 시 */
	var uploader_target1 = $("#uploader_target1").formuploader({
		SYSTEM_GCD : "0001", //시스템코드
		ATTACH_FILE_GCD : "0002", // 첨부파일 종류 코드 
		ATTACH_FILE_GRP_CD : $("#ATTACH_FILE_GRP_CD").val(), // 첨부파일 그룹 코드 
		ACCEPT_EXT : "GIF, JPG, PNG, JPEG", // 허용확장자 ( 메뉴설정에서 들고 오거나 지정한 확장자가 없으면 기본 확장자로 사용. )
		UPLOAD_SIZE : "4",
		FILE_ADD_YN : "Y", //신규추가가능여부
		FILE_DEL_YN : "Y", //삭제가능여부
		FILE_DWN_YN : "Y", //다운로드가능여부
		FILE_INFO_YN : "Y", /* 확장자와 제한용량 정보표시 여부*/
		FILE_AREA_WIDTH_PER : 100, /* 첨부파일영역의 %값 */
		FILE_COMMENT : "첨부가능문서 : 입영통지서 사본, 군복무확인서, 입영일자/결과조회(학사업무용)출력물(병무청홈페이지) <br/> 4MB 이하의 그림파일(gif, jpg, png, jpeg)만 업로드가 가능합니다. ",
		FILE_VIEWER_YN : "Y", /* 첨부파일뷰어 표시 여부 */
		dataBound : function(e, _target) { /* 업로드 완료후 처리 함수*/
			$("#ATTACH_FILE_GRP_CD").val($("#uploader_target1").find("#file_1").attr('attach_file_grp_cd'));
		}

	});
</script>