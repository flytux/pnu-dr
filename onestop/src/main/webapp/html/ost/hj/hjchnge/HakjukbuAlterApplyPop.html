<div id="popups">
	<section class="sec-1">
		<div class="sec-body">
			<div class="b-table-box flex-col-3" id="stdtTable" role="table" aria-label="학적정보 테이블">
				<div class="b-row-box" role="row">
					<div class="b-row-item merge-3">
						<div class="b-title-box" role="rowheader">
							<label data-lang>소속(과정)</label>
						</div>
						<div class="b-con-box" role="cell">
							<span data-bind="text: DEPT_NM"></span>
						</div>
					</div>
				</div>
				<div class="b-row-box" role="row">
					<div class="b-row-item">
						<div class="b-title-box" role="rowheader">
							<label data-lang>학번(성명)</label>
						</div>
						<div class="b-con-box" role="cell">
							<span data-bind="text: STDT_INFO"></span>
							<input type="hidden" id="STDT_NO" data-bind="value: STDT_NO" />
							<input type="hidden" id="STDT_KOR_NM" data-bind="value: STDT_KOR_NM" />
						</div>
					</div>
					<div class="b-row-item">
						<div class="b-title-box" role="rowheader">
							<label data-lang>학년(학기)</label>
						</div>
						<div class="b-con-box" role="cell">
							<span data-bind="text: STDT_YEAR_NM"></span>
						</div>
					</div>
					<div class="b-row-item">
						<div class="b-title-box" role="rowheader">
							<label data-lang>학적상태</label>
						</div>
						<div class="b-con-box" role="cell">
							<span data-bind="text: HJ_STA_NM"></span>
						</div>
					</div>
				</div>
			</div>
			<div class="b-table-box flex-col-2" id="stdtTable" role="table" aria-label="변경사항 테이블">
				<div class="b-row-box" role="row">
					<div class="b-row-item merge-2">
						<div class="b-title-box" role="rowheader">
							<label data-lang>신청학년도/학기</label>
						</div>
						<div class="b-con-box" role="cell">
							<span data-bind="text: APPLY_SYEAR_TERM"></span>
							<input type="hidden" id="APPLY_SYEAR" data-bind="value: APPLY_SYEAR" />
							<input type="hidden" id="APPLY_TERM_GCD" data-bind="value: APPLY_TERM_GCD" />
							<input type="hidden" id="CHG_SEQ_NO" data-bind="value: CHG_SEQ_NO" />
						</div>
					</div>
				</div>
				<div class="b-row-box" role="row">
					<div class="b-row-item merge-2">
						<div class="b-title-box" role="rowheader">
							<label data-lang>정정사유</label>
						</div>
						<div class="b-con-box" role="rowheader">
							<div class="form-check form-check-inline">
								<input class="form-check-input" type="radio" name="CHG_APPLY_REASON_GCD" id="radio1" value="0007" data-bind="checked: CHG_APPLY_REASON_GCD"
									checked>
								<label class="form-check-label mr-2" for="radio1" data-lang>성명 변경</label>
								<input class="form-check-input" type="radio" name="CHG_APPLY_REASON_GCD" id="radio2" value="0022" data-bind="checked: CHG_APPLY_REASON_GCD">
								<label class="form-check-label mr-2" for="radio2" data-lang>영문성명 변경</label>
								<input class="form-check-input" type="radio" name="CHG_APPLY_REASON_GCD" id="radio3" value="0008" data-bind="checked: CHG_APPLY_REASON_GCD">
								<label class="form-check-label mr-2" for="radio3" data-lang>주민등록번호 변경</label>
								<input class="form-check-input" type="radio" name="CHG_APPLY_REASON_GCD" id="radio4" value="0009" data-bind="checked: CHG_APPLY_REASON_GCD">
								<label class="form-check-label" for="radio4" data-lang>고학번미기재 주민등록번호 변경</label>
							</div>
						</div>
					</div>
				</div>
				<div class="b-row-box" role="row">
					<div class="b-row-item merge-2">
						<div class="b-title-box" role="rowheader">
							<label id="POST_STDT_NM_TXT" data-lang>성명</label>
						</div>
						<div class="b-con-box col-sm-3" role="cell">
							<input type="text" class="form-control" id="POST_STDT_NM" data-bind="value: APPLY_CONTENT_NM" />
						</div>
					</div>
				</div>
				<div class="b-row-box" role="row">
					<div class="b-row-item merge-2">
						<div class="b-title-box" role="rowheader">
							<label id="POST_SSN_TXT" for="POST_SSN1" data-lang>주민등록번호</label>
						</div>
						<div class="b-con-box" role="cell">
							<div class="row">
								<div class="col-sm-4">
									<input type="text" class="form-control numeric" id="POST_SSN1" data-bind="value: APPLY_CONTENT_SSN_1" maxlength="6" title="주민등록번호 앞자리" />
								</div>
								<div>
									<div class="col-1 py-1 ml-2 mr-2">-</div>
								</div>
								<div class="col-sm-4">
									<input type="password" class="form-control numeric" id="POST_SSN2" data-bind="value: APPLY_CONTENT_SSN_2" maxlength="7" title="주민등록번호 뒷자리" />
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="b-row-box" role="row">
					<div class="b-row-item">
						<div class="b-title-box" role="rowheader">
							<label class="req" for="STDT_CELLULAR_NO" data-lang>휴대폰번호</label>
						</div>
						<div class="b-con-box col-sm-5" role="cell">
							<input type="text" class="form-control" id="STDT_CELLULAR_NO" />
						</div>
					</div>
					<div class="b-row-item">
						<div class="b-con-box text-primary text-right" role="cell">
							<span class="info-text" data-lang>입력하신 휴대폰번호로 신청처리결과를 안내드리니 정확히 입력하시기 바랍니다.</span>
						</div>
					</div>
				</div>
				<div class="b-row-box" role="row">
					<div class="b-row-item merge-2">
						<div class="b-title-box" role="rowheader">
							<label>제출서류</label>
						</div>
						<div class="b-con-box" role="cell">
							<span class="mb-2 text-danger">※ 주민등록초본 또는 기본증명서, 학적부 기재사항 정정원, 신분증 사본</span>
							<ul class="list list-style-1">
								<li data-lang>제출서류는 신청일 기준 90일(3개월)이내의 최근 발급서류만 인정되며, 변동내역(성명,주민등록번호)이 기재 되어 있는 지 확인 하시기 바랍니다.</li>
								<li data-lang>성명변경 신청 시 주민등록번호 뒷자리 미표시하여 제출하시기 바랍니다.</li>
								<li data-lang>첨부파일은 JPG, PDF 파일형식으로 제출하시기 바랍니다.</li>
							</ul>
						</div>
					</div>
				</div>
				<div class="b-row-box" role="row">
					<div class="b-row-item merge-2">
						<div class="b-title-box" role="rowheader">
							<label class="req">첨부파일</label>
						</div>
						<div class="b-con-box" role="cell">
							<div class="sec-body" id="uploader_target1"></div>
							<div class="sec-body" id="uploader_target2"></div>
							<input type="hidden" id="ATTACH_FILE_GRP_CD" />
						</div>
					</div>
				</div>
			</div>
			<div class="_footer">
				<section class="sec-1">
					<div class="sec-body">
						<div class="btn-box">
							<div class="form-row btn-box-right">
								<div class="col-auto">
									<button class="btn btn-primary" id="btnSubmit" type="button" data-lang onclick="javascript:return fn_applySave('S');">제출</button>
									<button class="btn btn-danger" id="btnCancel" type="button" data-lang onclick="javascript:return fn_applySave('C');">신청취소</button>
								</div>
							</div>
						</div>
					</div>
				</section>
			</div>
		</div>
	</section>
</div>
<script type="text/javascript">
	$(document).ready(popInit());

	function popInit() {
		setInit();
		setBindFn();
	}

	$("#STDT_CELLULAR_NO").telEditor({
		txtVal : scwin.detailObj.CELLULAR_NO_TXT,
		originVal : scwin.detailObj.CELLULAR_NO,
		telnoGbn : "C", /* 휴대폰번호 : C, 전화번호(팩스) : T, ALL : A */
		telnoNm : "휴대폰번호",
		callbackFunc : function(e) {

		},
		dataBound : function(e) {

		}
	});

	/*  팝업창 로드 시 초기설정 함수 */
	function setInit() {
		gfn_com_dataBind($("#popups"), scwin.detailObj, '', function(e) {
			$("#POST_SSN1").attr("disabled", true);
			$("#POST_SSN2").attr("disabled", true);

			// 신규일 때는 신청, 상세보기에서는 신청취소만 가능
			if (scwin.rowState == "C") {
				$("input:radio[name=CHG_APPLY_REASON_GCD]:radio[value='0007']").prop('checked', true);
				$("#POST_STDT_NM_TXT").addClass("req");
				$("#uploader_target2").hide(); // 첨부파일 다운로드 컴포넌트
				$("#btnCancel").hide(); // 신청취소버튼
			} else {
				if (scwin.detailObj.CHG_APPLY_REASON_GCD == "0007" || scwin.detailObj.CHG_APPLY_REASON_GCD == "0022") {
					$("#POST_STDT_NM_TXT").addClass("req");
				} else {
					$("#POST_STDT_NM_TXT").addClass("req");
				}
				$("input:radio[name=CHG_APPLY_REASON_GCD]").attr("disabled", true);
				$("#POST_STDT_NM").attr("disabled", true);
				$("#POST_SSN1").attr("disabled", true);
				$("#POST_SSN2").attr("disabled", true);
				$("#STDT_CELLULAR_NO").attr("disabled", true);

				$("#uploader_target1").hide(); // 첨부파일 업로드 컴포넌트 
				$("#agreeTable").hide(); // 활용 동의서
				$("#btnSubmit").hide(); // 신청 버튼
			}
			
			/* 외국인 학생이 아닐 때는 영문성명 변경 선택 불가 */
			 if (gfn_str_parseNull(scwin.loginUser.nationCd) == "0410") {
				 $("input:radio[name=CHG_APPLY_REASON_GCD][value=0022]").attr("disabled", true);
			 }
		});
	}

	/* 이벤트 바인딩 함수 */
	function setBindFn() {
		// 정정사유 변경 시 이벤트
		$("input[name=CHG_APPLY_REASON_GCD]").change(function() {
			var chgApplyReasonGcd = $(this).val();

			if (chgApplyReasonGcd == "0007" ||  chgApplyReasonGcd == "0022") {
				$("#POST_SSN1").val("");
				$("#POST_SSN2").val("");
				$("#POST_SSN1").attr("disabled", true);
				$("#POST_SSN2").attr("disabled", true);
				$("#POST_SSN_TXT").removeClass("req");

				$("#POST_STDT_NM").val("");
				$("#POST_STDT_NM").attr("disabled", false);
				$("#POST_STDT_NM_TXT").addClass("req");
			} else {
				$("#POST_SSN1").val("");
				$("#POST_SSN2").val("");
				$("#POST_SSN1").attr("disabled", false);
				$("#POST_SSN2").attr("disabled", false);
				$("#POST_SSN_TXT").addClass("req");

				$("#POST_STDT_NM").val("");
				$("#POST_STDT_NM").attr("disabled", true);
				$("#POST_STDT_NM_TXT").removeClass("req");
			}
		});
	}

	/* 필수입력 체크 */
	function fn_validate() {
		var rtnValue = true;
		var valObj = [];

		if ($("input:radio[name=CHG_APPLY_REASON_GCD]:checked").val() == "0007" 
				|| $("input:radio[name=CHG_APPLY_REASON_GCD]:checked").val() == "0022") {
			valObj.push({
				"id" : "POST_STDT_NM",
				"name" : "성명",
				"notNull" : true,
			});
		} else {
			valObj.push({
				"id" : "POST_SSN1",
				"name" : "주민등록번호",
				"notNull" : true,
			});
			valObj.push({
				"id" : "POST_SSN2",
				"name" : "주민등록번호",
				"notNull" : true,
			});
		}

		valObj.push({
			"id" : "STDT_CELLULAR_NO",
			"name" : "휴대폰번호",
			"notNull" : true,
		});

		rtnValue = gfn_val_validateDataMap(param, valObj);

		if (!rtnValue)
			return rtnValue;

		return rtnValue;
	}

	/* 기타 유효성 체크 */
	function fn_validateEtc() {

		if ($(":input:radio[name=CHG_APPLY_REASON_GCD]:checked").val() != "0007" 
				&& $(":input:radio[name=CHG_APPLY_REASON_GCD]:checked").val() != "0022") {
			if (!fn_isRrnum($("#POST_SSN1").val() + $("#POST_SSN2").val())) {
				$("#SSN1").focus();
				alert("주민번호가 형식에 맞지 않습니다.");
				return;
			}
		}

		if ($("#uploader_target1").find(".attach-list li").length < 1) {
			alert("첨부파일은 필수 입력 사항 입니다.", $("#selFile"));
			return;
		}

		return true;
	}

	var param = [];

	/* 저장 함수 */
	function fn_applySave(type) {
		param = gfn_com_inputdata($("#popups"));
		param["rowState"] = scwin.rowState;

		// 신규일 때만 유효성 체크
		if (type == "S") {
			$("#ATTACH_FILE_GRP_CD").val($("#uploader_target1").find("#file_1").attr('attach_file_grp_cd'));

			param["ATTACH_FILE_GRP_CD"] = $("#ATTACH_FILE_GRP_CD").val();

			if (!fn_validate())
				return false;

			if (!fn_validateEtc())
				return false;

			confirm(gva_SAVE_CONFIRM_MSG, function(_flag) {
				if (_flag) {
					fn_clause();
				}
			});
		} else {
			confirm("신청 취소하시겠습니까?", function(_flag) {
				if (_flag) {
					fn_applySaveCallback();
				}
			});
		}
	}

	function fn_clause() {
		gfn_com_clausePop({
			title : '정보동의팝업',
			systemGcd : '0002',
			clauseSeqNo : 1,
			callbackFunc : function(data) {
				/* 필수동의 사항에 동의한 경우 콜백 실행 */
				param["agreeDltInfo"] = data; // 전달 파라미터에 정보동의 정보 담기			
				fn_applySaveCallback(); // 실제 정정신청 함수
			}
		});
	}

	function fn_applySaveCallback() {
		param["rowState"] = scwin.rowState;

		/* 정정신청 저장 함수 */
		gfn_ajax_request({
			url : "/ost/hj/hjchnge/hakjukbuAlterApply/executeHakjukbuAlterApply",
			reqData : param,
			success : function(data, responseData) {

				if (!gfn_com_isEmptyObject(data)) {
					/* 정정 신청 완료 */
					if (data.O_RSLT == "Y") {
						var attach_file_grp_cd = $("#ATTACH_FILE_GRP_CD").val();
						fn_fileComplete(attach_file_grp_cd);
						gfn_com_closeModalWall(1, function() {
							fn_sch();
							if (scwin.rowState == "C") {
								setTimeout(function() {
									alert(data.O_MSG, $("#resultTbody tr:eq(0)").find("a:eq(0)"));
								}, 300);
							} else {
								alert(data.O_MSG, $("#btnApply"));
							}

						});
					}else {
						alert(data.O_MSG);
					}
				}
			}
		});
	}

	/* 신규 신청 시 */
	var uploader_target1 = $("#uploader_target1").formuploader({
		SYSTEM_GCD : "0001", //시스템코드
		ATTACH_FILE_GCD : "0001", // 첨부파일 종류 코드 
		ACCEPT_EXT : "JPG, JPEG, PDF", // 허용확장자 ( 메뉴설정에서 들고 오거나 지정한 확장자가 없으면 기본 확장자로 사용. )
		UPLOAD_SIZE : "",
		FILE_ADD_YN : "Y", //신규추가가능여부
		FILE_DEL_YN : "Y", //삭제가능여부
		FILE_DWN_YN : "Y", //다운로드가능여부
		FILE_INFO_YN : "Y", /* 확장자와 제한용량 정보표시 여부*/
		FILE_AREA_WIDTH_PER : 100, /* 첨부파일영역의 %값 */
		FILE_COMMENT : "5MB 이하의 파일(jpg, jpeg, pdf)만 업로드가 가능합니다.<br/>개명한 내역이 나오는 주민등록초본, 기본증명서(상세) 를 첨부해 주시기 바랍니다.",
		FILE_VIEWER_YN : "Y", /* 첨부파일뷰어 표시 여부 */
		dataBound : function(e, _target) { /* 업로드 완료후 처리 함수*/
			alert("업로드 완료", _target);
		}

	});

	/* 신청취소 시 */
	var uploader_target2 = $("#uploader_target2").formuploader({
		SYSTEM_GCD : "0001", //시스템코드
		ATTACH_FILE_GCD : "0001", // 첨부파일 종류 코드 
		ATTACH_FILE_GRP_CD : scwin.detailObj.ATTACH_FILE_GRP_CD, // 첨부파일 그룹 코드 
		ACCEPT_EXT : "JPG, JPEG, PDF", // 허용확장자 ( 메뉴설정에서 들고 오거나 지정한 확장자가 없으면 기본 확장자로 사용. )
		UPLOAD_SIZE : "",
		FILE_ADD_YN : "N", //신규추가가능여부
		FILE_DEL_YN : "N", //삭제가능여부
		FILE_DWN_YN : "Y", //다운로드가능여부
		FILE_INFO_YN : "N", /* 확장자와 제한용량 정보표시 여부*/
		FILE_AREA_WIDTH_PER : 100, /* 첨부파일영역의 %값 */
		FILE_COMMENT : "",
		FILE_VIEWER_YN : "N", /* 첨부파일뷰어 표시 여부 */
		dataBound : function(e, _target) { /* 업로드 완료후 처리 함수*/
			alert("업로드 완료", _target);
		}

	});
</script>