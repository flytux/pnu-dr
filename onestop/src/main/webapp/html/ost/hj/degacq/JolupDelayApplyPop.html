<div id="popups">
	<section class="sec-1">
		<div class="sec-body">
			<div class="b-table-box flex-col-3" id="stdtTable" role="table" aria-label="학적정보 테이블">
				<div class="b-row-box" role="row">
					<div class="b-row-item merge-3">
						<div class="b-title-box" role="rowheader">
							<label data-lang>소속(과정)</label>
						</div>
                       <div class="b-con-box" role="cell">
							<span data-bind="text: DEPT_NM"></span>
						</div>
					</div>
				</div>
				<div class="b-row-box" role="row">
					<div class="b-row-item">
						<div class="b-title-box" role="rowheader">
							<label data-lang>학번(성명)</label>
						</div>
                        <div class="b-con-box" role="cell" data-bind="text: STDT_INFO">
                        </div>
						<input type="hidden" id="STDT_INFO" data-bind="value: STDT_INFO"/>
						<input type="hidden" id="STDT_NO" data-bind="value: STDT_NO"/>
					</div>
					<div class="b-row-item">
						<div class="b-title-box" role="rowheader">
							<label for="STDT_YEAR_TERM" data-lang>학년</label>
						</div>
                        <div class="b-con-box" role="cell" data-bind="text: STDT_YEAR_NM">
                        </div>
					</div>
					<div class="b-row-item">
						<div class="b-title-box" role="rowheader">
							<label data-lang>학적상태</label>
						</div>
                        <div class="b-con-box" role="cell" data-bind="text: HJ_STA_NM">
                        </div>
					</div>
				</div>
			</div>
			<div class="b-table-box flex-col-1" id="" role="table" aria-label="변경사항 테이블">
				<div class="b-row-box" role="row">
					<div class="b-row-item ">
						<div class="b-title-box" role="rowheader">
							<label class="req" for="APPLY_CONTENT" data-lang>학사학위취득<br>유예 사유</label>
						</div>
                        <div class="b-con-box" role="cell">
                        	<input id="APPLY_CONTENT" class="form-control" data-bind="value: APPLY_CONTENT"></input>
							<input type="hidden" id="APPLY_SYEAR" data-bind="value: APPLY_SYEAR"/>
							<input type="hidden" id="APPLY_TERM_GCD" data-bind="value: APPLY_TERM_GCD"/>
							<input type="hidden" id="CHG_SEQ_NO" data-bind="value: CHG_SEQ_NO"/>
							<input type="hidden" id="STA_GCD" data-bind="value: STA_GCD"/>
							<input type="hidden" id="SUPPOSE_SYEAR" data-bind="value: SUPPOSE_SYEAR"/>
							<input type="hidden" id="SUPPOSE_TERM_GCD" data-bind="value: SUPPOSE_TERM_GCD"/>
                        </div>
					</div>
				</div>
				<div class="b-row-box" role="row">
					<div class="b-row-item ">
						<div class="b-title-box" role="rowheader">
							<label class="req" data-lang>학사학위취득<br>유예 신청 횟수</label>
						</div>
						<div class="b-con-box" role="rowheader">
							<div class="form-check form-check-inline">
								<input class="form-check-input" type="radio" name="APPLY_COUNT" id="radio1" value="1" data-bind="checked: APPLY_COUNT"
									checked disabled>
								<label class="form-check-label mr-2" for="radio1" data-lang>최초신청</label>
								<input class="form-check-input" type="radio" name="APPLY_COUNT" id="radio2" value="2" data-bind="checked: APPLY_COUNT" disabled>
								<label class="form-check-label mr-2" for="radio2" data-lang>2회째 신청</label>
							</div>
						</div>
					</div>
				</div>
				<div class="b-row-box" role="row">
					<div class="b-row-item ">
						<div class="b-title-box" role="rowheader">
							<label data-lang>학사학위취득<br>유예 기간</label>
						</div>
                        <div class="b-con-box" role="cell" data-bind="text: SCHD_DT">
                        </div>
					</div>
				</div>
			</div>
			<div>
				<p class="">위 본인은 부산대학교 학칙 제71조의2 및 부산대학교 학사학위취득유예 운영규정에 따라 위와 같이 학사학위취득유예를 신청합니다.</p>
				<p class="text-center"><span id="YEAR"></span> 년		<span id="MONTH"></span>월		<span id="DAY"></span>일</p>
				<p class="text-center"><span id="STDT_NM"></span> 위 본 인</p>
				<p class="">부산대학교 총장 귀하</p>
			</div>
			<div class="b-table-box flex-col-5" id="" role="table" aria-label="인터넷 성적증명서 발급 번호">
				<div class="b-row-box" role="row">
					<div class="b-row-item ">
                        <div class="b-con-box" role="cell">
							<label class="req" for="SJ_CERT_DOCU_ISSUE_NO" data-lang>인터넷 성적증명서 발급 번호 : </label>
                        </div>
					</div>
					<div class="b-row-item merge-4">
                        <div class="b-con-box" role="cell">
							<select id="SJ_CERT_DOCU_ISSUE_NO" class="form-control" data-bind="selected:SJ_CERT_DOCU_ISSUE_NO"></select>
                        </div>
					</div>
				</div>
			</div>
			<p class="info-text">발급번호가 조회되지 않으면 <b>인터넷증명발급서비스<a class="link link-style-1" href="https://pnu.certpia.com" target="_blank" title="인터넷증명발급서비스 새창열기">바로가기</a>
				에서 국문성적증명서를 출력(발급신청, 미리보기만 하면 안됨)</b>한 후 해당페이지에 다시 접속하시면 조회됩니다.&nbsp;발급번호는 가장 최근에 발급한 순서로 조회됩니다.
			</p>
			<div class="message-box">
				<div class="message-box-inner">
					<div class="message-body">
						<p class="info-text info-text-style-2 mb-0">
							<b>학사학위취득유예자 유의사항</b>
						</p>
						<ul class="list list-style-1">
							<li>학사학위취득유예의 허가를 받은 자는 본교에서 정한 등록금을 납부하여야 하며, <span class="dfn">등록금을 납부하지 않을경우 학사학위취득유예를 직권취소 하고 당초 졸업예정 학기에 졸업처리 함.</span> </li>
							<li>학사학위취득유예는 재학연한 이내에 2회까지 신청 가능.</li>
							<li>학사학위취득유예자는 재학생 신분으로 졸업증명서 발급 불가함(졸업예정증명서 발급은 가능함). 또한 동기간 중에는 휴학 또는 학사학위취득유예 취소(일부 예외)를 할 수 없음. 	</li>
							<li>학사학위취득유예 기간 중 현금등록 이행 후, [별지 제2호 서식]의 사망, 부상, 질병, 군입대, 기타 부득이한 사유로 취소시 해당학기에 졸업 처리함. 동 기간 중 졸업예정증명서 발급은 가능함.</li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</section>
	<div class="_footer">
		<section class="sec-1">
			<div class="sec-body">
				<div class="btn-box">
					<div class="form-row btn-box-right">
						<div class="col-auto">
							<button class="btn btn-save" id="btnSubmit" type="button" data-lang onclick="javascript:return fn_chkSchdPop('C');">제출</button>
							<button class="btn btn-modify" id="btnCancel" type="button" data-lang onclick="javascript:return fn_applySave('D');">신청취소</button>
						</div>
					</div>
				</div>
			</div>
		</section>
	</div>
</div>
<script type="text/javascript">
	$(document).ready(popInit());

    function popInit() {
    	setInit();
    }

	/*  팝업창 로드 시 초기설정 함수 */
	function setInit() {
		if (scwin.loginUser.collGradGcd == "0002") {
			$("label[for='STDT_YEAR_TERM']").text('학기');
		}
		
		if(scwin.rowState == 'C'){
			$("#btnCancel").hide();
		}
		
		//console.log(scwin.detailObj);
		gfn_com_dataBind($("#popups"), scwin.detailObj);
		var nowDay = new Date();
		var year = nowDay.getFullYear();
		var month = nowDay.getMonth()+1;
		var date = nowDay.getDate();
		$("#YEAR").text(year);
		$("#MONTH").text(month);
		$("#DAY").text(date);
		$("#STDT_NM").text(scwin.loginUser.nm);
		fn_sjCertDocuIssueNoSch();
	}
	
	/* 신청가능기간여부 확인 */
	function fn_chkSchdPop(type) {
		var param = gfn_com_inputdata($("#popups"));
		if (!fn_validate(param)) return;
		
		type = scwin.rowState;
		
		gfn_ajax_request({
			url : "/ost/hj/degacq/JolupDelayApply/selectChkSchd",
	        reqData : param,
	        success : function(data, responseData) {
	        	if(data.O_RSLT == "N"){
	        		alert(data.O_MSG);
	        		return;
	        	}
	    		if(type=='C'){
	    			fn_chkApplyPop(type);
	    		}else{
		        	fn_applySave(type);
	    		}
	        }
	    });
	}

	/* 신청가능여부 확인 */
	function fn_chkApplyPop() {
		var param = gfn_com_inputdata($("#popups"));
		param.TIMESNO = scwin.detailObj.APPLY_COUNT;
		
		if (!fn_validate(param)) return;
		
		gfn_ajax_request({
			url : "/ost/hj/degacq/JolupDelayApply/selectChkApply",
	        reqData : param,
	        success : function(data, responseData) {
	        	if(data.O_RSLT == "N"){
	        		alert(data.O_MSG);
	        		return;
	        	}
	        	fn_applySave('C');
	        }
	    });
	}

	/* 필수체크 */
	function fn_validate(param) {
		if(param.SJ_CERT_DOCU_ISSUE_NO == "" || param.SJ_CERT_DOCU_ISSUE_NO == null){
				alert("성적증명서를 선택하세요.",$("#SJ_CERT_DOCU_ISSUE_NO"));
				return;
		}
		
		var rtnValue = true;
		var valInfo =  [{
								"id" : "APPLY_CONTENT",
								"name" : "신청사유",
								"notNull" : true,
							}];

		rtnValue = gfn_val_validateDataMap(param, valInfo);

		return rtnValue;
	}

	var confirmMsg = "";
	/* 저장 */
	function fn_applySave(type) {
		var param = gfn_com_inputdata($("#popups"));
		confirmMsg = gva_SAVE_CONFIRM_MSG;

		if(type == "D") {
			confirmMsg = "신청 취소하시겠습니까?";
			scwin.rowState = "D";
		}
		
		fn_applySaveCallback(param);
	}

	/* 저장 콜백 함수 */
	function fn_applySaveCallback(param) {
		param["rowState"] = scwin.rowState;  
		 confirm(confirmMsg,function(_flag){
			if(_flag) {
				if(scwin.rowState == 'U' && param.STA_GCD != '0001'){
					alert('접수 상태 일때만 수정 가능합니다.');
					return; 
				}
				if(scwin.rowState == 'D' && param.STA_GCD != '0001'){
					alert('접수 상태 일때만 취소 가능합니다.');
					return; 
				}
				gfn_ajax_request({
					url : "/ost/hj/degacq/JolupDelayApply/executeJolupDelayApply",
					reqData : param,
					success : function(data, responseData){
						
						if(data.O_RSLT == "Y") {
	        				gfn_com_closeModalWall(1,function(){
	        					alert(data.O_MSG);
	        					fn_sch();
	        				});				
						}
					}
				});
			}
		});
	}
	
	/*인터넷 성적증명서 발급 번호 조회*/
	function fn_sjCertDocuIssueNoSch() {
	    $.ajax({
			url : "https://certapi.pusan.ac.kr/getSinsang?hakbun="+scwin.detailObj.STDT_NO,
			type: "get",
			dataType : "json",
			contentType : "application/json",
			async: true,
			cache : false,
			success : function(responseData){
				$("#SJ_CERT_DOCU_ISSUE_NO").dropDownList({    
	     			dataSource : responseData.DATA,
	     			commonCode : null,
	     			dataTextField : "INI_SEQNO",
	     			dataValueField : "INI_SEQNO",
	     			dataBound : function(e) {
	     			}
	     		});
			}
	    });
	}

</script>