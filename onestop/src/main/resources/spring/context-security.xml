<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:security="http://www.springframework.org/schema/security"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans.xsd
http://www.springframework.org/schema/security https://www.springframework.org/schema/security/spring-security.xsd">
	
	<!-- 
	hasRole(Role) : 해당 Role 을 갖고있는 사용자 허용
	hasAnyRole(Role1, Role2, ...) : 해당 Role 중에 1개이상 갖고있는 사용자 허용
	anonymous : 익명 사용자 허용
	authenticated : 인증된 사용자 허용
	permitAll : 모든 사용자 허용
	denyAll : 모든 사용자 허용
	
	entry-point-ref : 인증되지 않은 사용자 리턴 처리
	 -->
	<!--  static resource 캐싱 -->
	<security:http pattern="/common/bootstrap-4.6.1/**" security="none" ></security:http>
	<security:http pattern="/common/bootstrap-table-master/**" security="none" ></security:http>
	<security:http pattern="/common/ckeditor/**" security="none" ></security:http>
	<security:http pattern="/common/css/**" security="none" ></security:http>
	<security:http pattern="/common/fonts/**" security="none" ></security:http>
	<security:http pattern="/common/images/**" security="none" ></security:http>
	<security:http pattern="/common/images_ses/**" security="none" ></security:http>
	<security:http pattern="/common/js/**" security="none" ></security:http>

	<security:http pattern="/core/function/getCommonMessage" security="none"></security:http>
    <security:http pattern="/clip/Clip.jsp" security="none"></security:http>
    <security:http pattern="/clip/**" security="none"></security:http>    
    <security:http pattern="/comn/photo/**" security="none"></security:http>
    <security:http pattern="/comn/txtDwnload/**" security="none"></security:http>   
    <security:http pattern="/html/ost/core/popup/contents/**" security="none"></security:http>
    <security:http auto-config="true" use-expressions="true" entry-point-ref="authenticationEntryPointHandler">
		<!-- 동적 체크 -->
		<security:expression-handler ref="customWebSecurityExpressionHandler"/>
		<!-- intercept-url 설정 -->       
		<security:intercept-url pattern="/*.nsf" access="ignorePage()"/>
		<security:intercept-url pattern="/*.NSF" access="ignorePage()" />       
        <security:intercept-url pattern="/file/**" access="customPage()"/>
        <security:intercept-url pattern="/login" access="permitAll"/>
        <security:intercept-url pattern="/core/function/**" access="permitAll"/>        
        <security:intercept-url pattern="/core/**" access="permitAll"/>
        <security:intercept-url pattern="/common/**" access="permitAll"/>
        <security:intercept-url pattern="/error/**" access="permitAll"/>
        <security:intercept-url pattern="/**" access="permitAll"/>
		<security:access-denied-handler ref="customAccessDeniedHandler"/>
		
		<!-- csrf 설정 -->
		<security:csrf disabled="false"/>

		<security:form-login login-page="/login" 
		                             authentication-success-handler-ref="loginSuccessHandler"
			                         authentication-failure-handler-ref="loginFailureHandler" 
			                         login-processing-url="/login/loginCheck" 
			                         username-parameter="USER_ID" 
			                         password-parameter="PWD" />
			
		<security:logout logout-url="/logout" 
		                        invalidate-session="true" 
		                        logout-success-url="/login.do?status=logout" />
		                        
		<!-- <security:session-management invalid-session-url="/login">
			<security:concurrency-control max-sessions="1" error-if-maximum-exceeded="false" />
		</security:session-management> -->
		
        <security:headers>
             <security:frame-options policy="SAMEORIGIN"/>
        </security:headers>
	</security:http>
     
    <!-- provider -->
	<security:authentication-manager>
		<security:authentication-provider ref="customAuthenticationProvider"/>
	</security:authentication-manager>
	
    <bean id="customMethodSecurityExpressionHandler" class="com.onestop.core.security.expression.CustomMethodSecurityExpressionHandler">
    </bean>
     
	<bean id="loginSuccessHandler" class="com.onestop.core.security.handler.LoginSuccessHandler">
		<property name="defaultTargetUrl" value="/main" />
		<property name="alwaysUseDefaultTargetUrl" value="true" />
	</bean>
	<bean id="loginFailureHandler" class="com.onestop.core.security.handler.LoginFailureHandler">
		<property name="defaultFailureUrl" value="/login?status=fail" />
	</bean>
	

</beans>
